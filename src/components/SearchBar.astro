---
---

<div class="relative">
  <input
    type="text"
    id="search-input"
    placeholder="Search posts..."
    class="w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-red-500"
  />
  <div
    id="search-results"
    class="absolute z-50 w-full mt-2 bg-white dark:bg-slate-800 border dark:border-gray-700 rounded-lg shadow-lg hidden"
  >
  </div>
</div>

<script>
  let posts = [];
  let searchTimeout;

  async function fetchPosts() {
    const response = await fetch('/search-index.json');
    posts = await response.json();
  }

  function debounce(func, wait) {
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(searchTimeout);
        func(...args);
      };
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(later, wait);
    };
  }

  function performSearch(searchTerm) {
    if (!searchTerm) {
      document.getElementById('search-results').classList.add('hidden');
      return;
    }

    const searchTermLower = searchTerm.toLowerCase();
    const results = posts.filter(post => 
      post.title.toLowerCase().includes(searchTermLower) ||
      post.description.toLowerCase().includes(searchTermLower) ||
      post.category.toLowerCase().includes(searchTermLower)
    ).slice(0, 5);

    const resultsContainer = document.getElementById('search-results');
    
    if (results.length > 0) {
      resultsContainer.innerHTML = results.map(post => `
        <a href="/blog/${post.slug}" class="block p-4 hover:bg-gray-50 dark:hover:bg-slate-700">
          <h3 class="font-semibold text-gray-900 dark:text-gray-100">${post.title}</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">${post.category}</p>
        </a>
      `).join('');
      resultsContainer.classList.remove('hidden');
    } else {
      resultsContainer.innerHTML = `
        <div class="p-4 text-gray-600 dark:text-gray-400">
          No results found
        </div>
      `;
      resultsContainer.classList.remove('hidden');
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    fetchPosts();

    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');
    const debouncedSearch = debounce(performSearch, 300);

    searchInput.addEventListener('input', (e) => {
      debouncedSearch(e.target.value);
    });

    // Close search results when clicking outside
    document.addEventListener('click', (e) => {
      if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
        searchResults.classList.add('hidden');
      }
    });
  });
</script>
